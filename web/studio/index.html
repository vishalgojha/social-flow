<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Social API Gateway Studio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@500;700;800&family=JetBrains+Mono:wght@400;500;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="background-layer"></div>

  <main class="app-shell">
    <header class="topbar">
      <div class="topbar-logo">
        <span class="logo-dot"></span>
        LOCALHOST GATEWAY
      </div>
      <div class="topbar-sep"></div>
      <div class="topbar-status">
        <span class="mono">Mission Control</span>
        <span id="topApiBadge" class="badge badge-ok">API LIVE</span>
        <span id="topPendingBadge" class="badge badge-warn">0 PENDING</span>
      </div>
      <div class="topbar-live mono">
        <span>ws=<span id="topWorkspaceText">default</span></span>
        <span>lat=<span id="topLatencyText">-</span></span>
        <span>now=<span id="topClockText">--:--:--</span></span>
      </div>
      <div class="topbar-kpis">
        <div class="kpi"><span id="kpiMessages" class="kpi-val">0</span><span class="kpi-label">Messages</span></div>
        <div class="kpi"><span id="kpiPending" class="kpi-val kpi-pend">0</span><span class="kpi-label">Pending</span></div>
        <div class="kpi"><span id="kpiExecuted" class="kpi-val kpi-ok">0</span><span class="kpi-label">Executed</span></div>
        <div class="kpi"><span id="kpiSessions" class="kpi-val kpi-info">0</span><span class="kpi-label">Sessions</span></div>
      </div>
      <button id="themeToggleBtn" class="ghost-btn top-theme-btn" aria-label="Toggle theme">Theme: Dark</button>
      <button id="notifBtn" class="topbar-bell" aria-label="Notifications">
        <span class="bell-dot"></span>
      </button>
    </header>

    <aside class="left-rail">
      <section class="brand">
        <div class="logo-ring"></div>
        <div>
          <h1>LOCALHOST CONTROL</h1>
          <p>Agency Ops Mission Control</p>
          <p>Works with Meta APIs</p>
          <p id="buildLabel" class="build-label">Build: loading...</p>
        </div>
      </section>

      <section class="panel nav-panel">
        <p class="section-label">Main</p>
        <button class="side-nav-item active" data-view="chat">Chat Agent</button>
        <button class="side-nav-item" data-view="data">Data Console</button>
        <button class="side-nav-item" data-view="ops">Ops Center</button>
        <button class="side-nav-item" data-view="config">Config</button>
        <button class="side-nav-item" data-view="devtools">Developer Toolkit</button>
        <button class="side-nav-item" data-view="help">Help</button>
        <button class="side-nav-item" data-view="settings">Settings</button>
      </section>

      <section class="panel">
        <div class="panel-head">
          <p class="section-label">Sessions</p>
          <button id="newSessionBtn" class="ghost-btn small">New</button>
        </div>
        <ul id="sessionsList" class="sessions-list"></ul>
      </section>

      <section class="panel">
        <p class="section-label">Quick Prompts</p>
        <div class="chips">
          <button class="chip" data-prompt="I need to launch our new product tomorrow on Facebook and Instagram">Launch Plan</button>
          <button class="chip" data-prompt="Check my ad performance for last 7 days">Ad Analytics</button>
          <button class="chip" data-prompt="Send WhatsApp message 'Order confirmed' to +15551234567">WhatsApp Send</button>
          <button class="chip" data-prompt="List my active campaigns for account act_123456789">Campaign Scan</button>
          <button class="chip" data-prompt="Check auth status for this profile">Auth Status</button>
          <button class="chip" data-prompt="setup ollama llama3.1:8b for local ai">Setup Local AI</button>
        </div>
      </section>

      <section class="panel tiny">
        <p class="section-label">Gateway</p>
        <p id="healthStatus">Connecting...</p>
      </section>
    </aside>

    <section class="chat-stage">
      <header class="top-banner">
        <div>
          <p id="viewTag" class="tag">Chat Agent</p>
          <h2 id="viewTitle">Talk naturally. Execute safely.</h2>
        </div>
        <div class="session-pill">Session: <span id="sessionIdText">-</span></div>
      </header>

      <section id="view-chat" class="view-panel active">
        <div class="chat-meta-strip mono">
          <span>channel: chat.agent.default</span>
          <span>guard: evidence + approvals</span>
        </div>
        <section id="messageList" class="message-list"></section>
        <footer class="composer">
          <textarea id="messageInput" rows="2" placeholder="Type a message..."></textarea>
          <div class="composer-actions">
            <button id="sendBtn" class="send-btn">Send</button>
          </div>
        </footer>
      </section>

      <section id="view-data" class="view-panel">
        <div class="data-grid">
          <article class="data-card">
            <h3>Recent History</h3>
            <div id="dataHistory" class="table-wrap"></div>
          </article>
          <article class="data-card">
            <h3>Pending Actions</h3>
            <div id="dataPending" class="table-wrap"></div>
          </article>
          <article class="data-card">
            <h3>Executed Actions</h3>
            <div id="dataExecuted" class="table-wrap"></div>
          </article>
        </div>
      </section>

      <section id="view-ops" class="view-panel">
        <div class="ops-wrap">
          <div class="ops-toolbar">
            <div class="ops-workspace">Workspace: <span id="opsWorkspaceText">default</span></div>
            <div class="ops-actions">
              <button id="opsRefreshBtn" class="ghost-btn small">Refresh</button>
              <button id="opsMorningBtn" class="ghost-btn small">Run Morning Ops</button>
              <button id="opsRunDueBtn" class="ghost-btn small">Run Due Schedules</button>
            </div>
          </div>

          <div class="ops-kpis">
            <article class="ops-kpi-card">
              <p class="ops-kpi-label">Open Alerts</p>
              <p id="opsAlertsOpen" class="ops-kpi-value">0</p>
            </article>
            <article class="ops-kpi-card">
              <p class="ops-kpi-label">Pending Approvals</p>
              <p id="opsApprovalsPending" class="ops-kpi-value">0</p>
            </article>
            <article class="ops-kpi-card">
              <p class="ops-kpi-label">Leads Due</p>
              <p id="opsLeadsDue" class="ops-kpi-value">0</p>
            </article>
            <article class="ops-kpi-card">
              <p class="ops-kpi-label">Schedules Due</p>
              <p id="opsSchedulesDue" class="ops-kpi-value">0</p>
            </article>
          </div>

          <div class="ops-grid">
            <article class="data-card">
              <div class="ops-card-head">
                <h3>Guard Rail</h3>
                <button id="opsGuardRefreshBtn" class="ghost-btn small">Reload Guard</button>
              </div>
              <div class="guard-controls">
                <label class="guard-field">
                  <span>Mode</span>
                  <select id="opsGuardModeSelect">
                    <option value="observe">observe</option>
                    <option value="approval">approval</option>
                    <option value="auto_safe">auto_safe</option>
                  </select>
                </label>
                <button id="opsGuardModeSaveBtn" class="ghost-btn small">Save Mode</button>
                <label class="guard-field">
                  <span>Spend Spike %</span>
                  <input id="opsGuardSpendSpikeInput" type="number" min="1" step="1" />
                </label>
                <label class="guard-field">
                  <span>CPA Spike %</span>
                  <input id="opsGuardCpaSpikeInput" type="number" min="1" step="1" />
                </label>
                <label class="guard-field">
                  <span>ROAS Drop %</span>
                  <input id="opsGuardRoasDropInput" type="number" min="1" step="1" />
                </label>
                <label class="guard-field">
                  <span>Max Budget Adj %</span>
                  <input id="opsGuardMaxBudgetAdjInput" type="number" min="1" step="1" />
                </label>
                <label class="guard-field">
                  <span>Max Campaigns / Run</span>
                  <input id="opsGuardMaxCampaignsInput" type="number" min="1" step="1" />
                </label>
                <label class="guard-field">
                  <span>Max Daily Auto Actions</span>
                  <input id="opsGuardMaxDailyAutoInput" type="number" min="1" step="1" />
                </label>
                <label class="guard-field">
                  <span>Cooldown Minutes</span>
                  <input id="opsGuardCooldownInput" type="number" min="1" step="1" />
                </label>
                <label class="guard-toggle">
                  <input id="opsGuardEnabledInput" type="checkbox" />
                  <span>Guard Enabled</span>
                </label>
                <label class="guard-toggle">
                  <input id="opsGuardRequirePauseApprovalInput" type="checkbox" />
                  <span>Require Pause Approval</span>
                </label>
                <button id="opsGuardPolicySaveBtn" class="ghost-btn small">Save Guard Policy</button>
              </div>
              <p id="opsGuardStatusText" class="guard-status">Guard policy not loaded yet.</p>
            </article>

            <article class="data-card">
              <div class="ops-card-head">
                <h3>Knowledge Sources</h3>
                <button id="opsSourcesRefreshBtn" class="ghost-btn small">Refresh Sources</button>
              </div>
              <div class="source-controls">
                <label class="guard-field">
                  <span>Name</span>
                  <input id="opsSourceNameInput" type="text" placeholder="Example: Meta Campaign Feed" />
                </label>
                <label class="guard-field">
                  <span>Connector</span>
                  <select id="opsSourceConnectorSelect">
                    <option value="facebook_ads">facebook_ads</option>
                    <option value="instagram_insights">instagram_insights</option>
                    <option value="whatsapp_events">whatsapp_events</option>
                    <option value="marketing_campaigns">marketing_campaigns</option>
                    <option value="csv_upload">csv_upload</option>
                    <option value="webhook">webhook</option>
                    <option value="custom">custom</option>
                  </select>
                </label>
                <label class="guard-field">
                  <span>Sync Mode</span>
                  <select id="opsSourceSyncModeSelect">
                    <option value="manual">manual</option>
                    <option value="scheduled">scheduled</option>
                  </select>
                </label>
                <label class="guard-toggle">
                  <input id="opsSourceEnabledInput" type="checkbox" checked />
                  <span>Enabled</span>
                </label>
                <div class="source-actions">
                  <button id="opsSourceSaveBtn" class="ghost-btn small">Save Source</button>
                  <button id="opsSourceSyncBtn" class="ghost-btn small">Sync All</button>
                </div>
              </div>
              <div id="opsSourcesTable" class="table-wrap"></div>
              <p id="opsSourcesStatusText" class="guard-status">No sources loaded yet.</p>
            </article>

            <article class="data-card">
              <div class="ops-card-head">
                <h3>Alerts</h3>
                <button id="opsAckTokenBtn" class="ghost-btn small">Ack Token Alerts</button>
              </div>
              <div id="opsAlertsTable" class="table-wrap"></div>
            </article>

            <article class="data-card">
              <div class="ops-card-head">
                <h3>Approvals</h3>
                <button id="opsApproveLowBtn" class="ghost-btn small">Approve Low Risk</button>
              </div>
              <div id="opsApprovalsTable" class="table-wrap"></div>
            </article>

            <article class="data-card">
              <h3>Leads Due</h3>
              <div id="opsLeadsTable" class="table-wrap"></div>
            </article>

            <article class="data-card">
              <h3>Recent Outcomes</h3>
              <div id="opsOutcomesTable" class="table-wrap"></div>
            </article>
          </div>
        </div>
      </section>

      <section id="view-config" class="view-panel">
        <div class="config-head">
          <h3>Runtime Config</h3>
          <button id="refreshConfigBtn" class="ghost-btn small">Refresh</button>
        </div>
        <pre id="configDump" class="config-dump">Loading...</pre>
      </section>

      <section id="view-help" class="view-panel">
        <div class="help-grid">
          <article class="data-card">
            <h3>Developer</h3>
            <p>check auth status for this profile</p>
            <p>list webhook subscriptions for this app</p>
            <p>debug token &lt;token&gt;</p>
          </article>
          <article class="data-card">
            <h3>Marketing</h3>
            <p>check my ad performance for last 7 days</p>
            <p>list my active campaigns</p>
            <p>create campaign "Summer Sale" ...</p>
          </article>
          <article class="data-card">
            <h3>Conversation</h3>
            <p>Use <strong>yes</strong> to run pending actions.</p>
            <p>Use <strong>no</strong> to cancel and adjust.</p>
            <p>Ask naturally. The agent will follow up.</p>
            <p>If no API key is configured, ask: <strong>setup ollama llama3.1:8b</strong>.</p>
          </article>
        </div>
      </section>

      <section id="view-devtools" class="view-panel">
        <div class="devtools-grid">
          <article class="data-card">
            <h3>Social CLI Commands</h3>
            <div class="tool-list">
              <div class="tool-row">
                <code>social auth status</code>
                <button class="ghost-btn small copy-btn" data-copy="social auth status">Copy</button>
              </div>
              <div class="tool-row">
                <code>social query me --api facebook</code>
                <button class="ghost-btn small copy-btn" data-copy="social query me --api facebook">Copy</button>
              </div>
              <div class="tool-row">
                <code>social agent setup --provider ollama --model llama3.1:8b</code>
                <button class="ghost-btn small copy-btn" data-copy="social agent setup --provider ollama --model llama3.1:8b">Copy</button>
              </div>
              <div class="tool-row">
                <code>social gateway --open</code>
                <button class="ghost-btn small copy-btn" data-copy="social gateway --open">Copy</button>
              </div>
            </div>
          </article>

          <article class="data-card">
            <h3>Provider Setup</h3>
            <div class="tool-list">
              <div class="tool-row">
                <code>setx OPENAI_API_KEY "YOUR_KEY"</code>
                <button class="ghost-btn small copy-btn" data-copy="setx OPENAI_API_KEY &quot;YOUR_KEY&quot;">Copy</button>
              </div>
              <div class="tool-row">
                <code>setx ANTHROPIC_API_KEY "YOUR_KEY"</code>
                <button class="ghost-btn small copy-btn" data-copy="setx ANTHROPIC_API_KEY &quot;YOUR_KEY&quot;">Copy</button>
              </div>
              <div class="tool-row">
                <code>setx OPENROUTER_API_KEY "YOUR_KEY"</code>
                <button class="ghost-btn small copy-btn" data-copy="setx OPENROUTER_API_KEY &quot;YOUR_KEY&quot;">Copy</button>
              </div>
              <div class="tool-row">
                <code>ollama pull llama3.1:8b</code>
                <button class="ghost-btn small copy-btn" data-copy="ollama pull llama3.1:8b">Copy</button>
              </div>
            </div>
          </article>

          <article class="data-card devtools-wide">
            <h3>Developer Notes</h3>
            <p>Use Data Console to inspect session history, pending actions, and execution results from the gateway in real time.</p>
            <p>Use Config to verify active profile, defaults, and token state before high-risk actions.</p>
            <p>Use Chat Agent for natural language planning and CLI commands for deterministic execution paths.</p>
          </article>
        </div>
      </section>

      <section id="view-settings" class="view-panel">
        <div class="settings-list">
          <label class="setting-item">
            <input type="checkbox" id="settingEnterSend" checked />
            <span>Press Enter to send</span>
          </label>
          <label class="setting-item">
            <input type="checkbox" id="settingAutoScroll" checked />
            <span>Auto scroll chat</span>
          </label>
          <label class="setting-item">
            <input type="checkbox" id="settingCompactMode" />
            <span>Extra compact mode</span>
          </label>
          <label class="setting-item setting-select-row">
            <span>Theme mode</span>
            <select id="settingThemeMode" class="setting-select">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
              <option value="system">System</option>
            </select>
          </label>
        </div>
      </section>
    </section>
  </main>

  <template id="messageTemplate">
    <article class="bubble">
      <div class="bubble-role"></div>
      <div class="bubble-text"></div>
      <div class="bubble-meta"></div>
    </article>
  </template>

  <script src="/app.js" defer></script>
</body>
</html>
